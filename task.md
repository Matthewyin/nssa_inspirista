# 📋 **任务管理系统AI增强功能需求说明书**

## 1. 项目概述

### 1.1 项目背景
现有任务管理系统需要增强AI功能，为用户提供智能的短期任务规划能力，专注于30天内的计划任务。

### 1.2 项目目标
- 简化任务创建流程，集成AI辅助功能
- 引入里程碑概念，提升任务执行的可追踪性
- 完善国际化支持，提供中英文双语界面
- 优化用户体验，专注短期目标管理

### 1.3 产品定位
短期任务规划工具，帮助用户在3-30天内完成具体目标，通过AI生成合理的里程碑计划。

## 2. 功能需求

### 2.1 任务创建功能重构

#### 2.1.1 表单简化
- **移除字段**：优先级、分类、截止日期、标签、预估时间
- **保留字段**：任务标题、任务描述
- **新增功能**：AI生成计划按钮

#### 2.1.2 AI集成
- 在任务描述框中集成AI生成功能
- 用户输入目标后，点击"AI生成计划"按钮
- AI返回格式化的任务计划，替换描述框内容
- 用户可编辑AI生成的内容

### 2.2 AI任务规划功能

#### 2.2.1 输入格式识别
- 识别"X天内"格式，提取时间范围
- 未指定天数时，默认7天
- 支持学习类和工作类目标

#### 2.2.2 AI输出格式
```
总体规划：[一句话描述整体计划，15字内]

里程碑计划：
里程碑1（第1-X天）：[具体要完成的内容，20字左右]
里程碑2（第X-Y天）：[具体要完成的内容，20字左右]
里程碑3（第Y-Z天）：[具体要完成的内容，20字左右]

推荐标签：#标签1 #标签2
```

#### 2.2.3 AI服务支持
- 支持Gemini API和DeepSeek API
- 自动故障转移机制
- API密钥验证和错误处理

### 2.3 里程碑管理功能

#### 2.3.1 里程碑数据结构
- 里程碑标题和描述
- 目标完成日期（基于开始日期+天数计算）
- 完成状态跟踪
- 天数范围显示

#### 2.3.2 里程碑显示逻辑
- **未开始任务**：不显示里程碑详情
- **进行中任务**：显示里程碑进度和状态
- **已完成任务**：不显示里程碑详情

#### 2.3.3 自动完成机制
- 所有里程碑完成时，自动标记任务完成
- 支持手动标记里程碑完成
- 实时更新任务进度

### 2.4 国际化功能完善

#### 2.4.1 新增翻译内容
- AI相关界面文字
- 里程碑相关术语
- 任务状态和进度描述
- 错误提示和成功消息

#### 2.4.2 覆盖范围
- 任务创建表单
- 任务列表和卡片
- 筛选器和选项卡
- AI生成相关界面

## 3. 技术需求

### 3.1 数据库设计

#### 3.1.1 任务数据结构更新
```typescript
interface Task {
  id: string;
  userId: string;
  title: string;
  description: string;        // 包含AI生成的完整计划
  status: 'todo' | 'in_progress' | 'completed';
  tags: string[];            // AI生成的2个标签
  milestones: Milestone[];   // 里程碑列表
  isAIGenerated: boolean;    // 是否AI生成
  aiPrompt?: string;         // 原始用户输入
  startDate: Date;           // 任务开始日期
  createdAt: Date;
  updatedAt: Date;
}
```

#### 3.1.2 里程碑数据结构
```typescript
interface Milestone {
  id: string;
  title: string;
  description: string;
  targetDate: Date;
  isCompleted: boolean;
  completedDate?: Date;
  dayRange: string;          // 如"第1-2天"
}
```

### 3.2 AI服务集成

#### 3.2.1 AI任务生成器重构
- 重新设计prompt模板
- 优化响应解析逻辑
- 增强错误处理机制

#### 3.2.2 多AI服务支持
- Gemini API集成
- DeepSeek API集成
- 自动故障转移

### 3.3 前端组件重构

#### 3.3.1 任务创建表单
- 简化表单字段
- 集成AI生成按钮
- 实时内容更新

#### 3.3.2 任务显示组件
- 里程碑进度显示
- 状态条件渲染
- 移动端适配

## 4. 用户体验需求

### 4.1 界面设计

#### 4.1.1 任务创建流程
1. 用户输入标题和描述
2. 点击"AI生成计划"按钮
3. 描述框内容被AI生成内容替换
4. 用户可编辑内容
5. 创建任务，自动解析里程碑

#### 4.1.2 任务状态显示
- 未开始：显示基本信息
- 进行中：显示里程碑进度
- 已完成：显示完成信息

### 4.2 移动端适配
- 表单从上到下垂直布局
- 里程碑列表卡片式显示
- 触摸友好的交互设计

### 4.3 错误处理
- AI生成失败时的降级方案
- 网络错误的用户提示
- 数据验证错误处理

## 5. 非功能性需求

### 5.1 性能要求
- AI生成响应时间 < 10秒
- 页面加载时间 < 3秒
- 支持离线基本功能

### 5.2 兼容性要求
- 支持主流浏览器
- 响应式设计
- 移动端优化

### 5.3 安全要求
- API密钥安全存储
- 用户数据隐私保护
- 输入内容验证

---

# 🎯 **任务计划 Task List**

## Phase 1: 数据结构和后端服务 (3-4天)

### Task 1.1: 数据库结构设计和迁移
- **描述**: 设计新的Task和Milestone数据结构，创建数据库迁移脚本
- **里程碑**:
  - 里程碑1（第1天）：设计TypeScript接口和数据库schema
  - 里程碑2（第2天）：创建Firebase数据迁移逻辑
  - 里程碑3（第3天）：测试数据结构和CRUD操作
- **标签**: #数据库 #后端

### Task 1.2: AI服务重构
- **描述**: 重构AITaskGenerator类，优化prompt和响应解析
- **里程碑**:
  - 里程碑1（第1天）：设计新的prompt模板和输出格式
  - 里程碑2（第2天）：实现响应解析和里程碑提取逻辑
  - 里程碑3（第3天）：集成多AI服务和错误处理
- **标签**: #AI服务 #后端

### Task 1.3: Firebase服务层更新
- **描述**: 更新taskService以支持里程碑管理和AI任务创建
- **里程碑**:
  - 里程碑1（第1天）：更新createTask和createAITask方法
  - 里程碑2（第2天）：实现里程碑CRUD操作
  - 里程碑3（第3天）：添加任务状态自动更新逻辑
- **标签**: #Firebase #后端

## Phase 2: 前端组件重构 (4-5天)

### Task 2.1: 任务创建表单重构
- **描述**: 简化表单字段，集成AI生成功能
- **里程碑**:
  - 里程碑1（第1-2天）：移除不需要的字段，重新设计表单布局
  - 里程碑2（第3天）：集成AI生成按钮和状态管理
  - 里程碑3（第4天）：实现内容替换和编辑功能
- **标签**: #前端组件 #表单

### Task 2.2: 任务显示组件更新
- **描述**: 更新任务卡片和列表，支持里程碑显示
- **里程碑**:
  - 里程碑1（第1-2天）：设计里程碑进度显示组件
  - 里程碑2（第3天）：实现条件渲染逻辑（根据任务状态）
  - 里程碑3（第4天）：优化移动端显示效果
- **标签**: #前端组件 #UI

### Task 2.3: 里程碑管理组件
- **描述**: 创建里程碑相关的UI组件
- **里程碑**:
  - 里程碑1（第1天）：设计里程碑列表和进度条组件
  - 里程碑2（第2天）：实现里程碑完成状态切换
  - 里程碑3（第3天）：添加里程碑编辑和删除功能
- **标签**: #前端组件 #里程碑

## Phase 3: 国际化完善 (2-3天)

### Task 3.1: 翻译内容补充
- **描述**: 为新功能添加中英文翻译
- **里程碑**:
  - 里程碑1（第1天）：添加AI相关界面翻译
  - 里程碑2（第2天）：添加里程碑相关翻译
  - 里程碑3（第3天）：完善错误提示和状态描述翻译
- **标签**: #国际化 #翻译

### Task 3.2: 国际化测试和优化
- **描述**: 测试中英文切换，优化显示效果
- **里程碑**:
  - 里程碑1（第1天）：测试所有新增界面的语言切换
  - 里程碑2（第2天）：优化长文本显示和布局适配
  - 里程碑3（第3天）：修复国际化相关bug
- **标签**: #测试 #优化

## Phase 4: 集成测试和优化 (2-3天)

### Task 4.1: 功能集成测试
- **描述**: 端到端测试新功能，确保各模块正常协作
- **里程碑**:
  - 里程碑1（第1天）：测试完整的任务创建流程
  - 里程碑2（第2天）：测试里程碑管理和状态更新
  - 里程碑3（第3天）：测试AI生成和错误处理
- **标签**: #测试 #集成

### Task 4.2: 性能优化和bug修复
- **描述**: 优化性能，修复测试中发现的问题
- **里程碑**:
  - 里程碑1（第1天）：优化AI生成响应时间和用户体验
  - 里程碑2（第2天）：修复数据同步和状态管理问题
  - 里程碑3（第3天）：完善错误处理和边界情况
- **标签**: #优化 #修复

### Task 4.3: 用户体验优化
- **描述**: 根据测试反馈优化用户界面和交互
- **里程碑**:
  - 里程碑1（第1天）：优化移动端显示效果
  - 里程碑2（第2天）：改进加载状态和反馈提示
  - 里程碑3（第3天）：最终用户体验测试和调整
- **标签**: #用户体验 #优化

## 总计划时间：11-15天

**预计完成时间**: 2-3周
**关键里程碑**: 
- 第1周末：后端服务和数据结构完成
- 第2周末：前端组件和国际化完成  
- 第3周末：测试优化和最终交付

您觉得这个需求说明书和任务计划如何？需要调整哪些部分？
